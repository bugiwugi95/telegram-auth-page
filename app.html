<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§—É—Ç–±–æ–ª—å–Ω—ã–π –ê–Ω–∞–ª–∏—Ç–∏–∫ | –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ========================================================================= */
        /* CSS –°—Ç–∏–ª–∏ –¥–ª—è UI (–û–°–ù–û–í–ù–´–ï) */
        /* ========================================================================= */
        :root {
            /* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ü–≤–µ—Ç–æ–≤ Telegram */
            --tg-bg: var(--tg-theme-bg-color, #f0f4f7);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #000000);
            --tg-hint: var(--tg-theme-hint-color, #999999);
            --tg-link: var(--tg-theme-link-color, #2481cc);
            --tg-button: var(--tg-theme-button-color, #2481cc);
            --tg-button-text: var(--tg-theme-button-text-color, #ffffff);

            /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ü–≤–µ—Ç–∞ */
            --primary: var(--tg-button);
            --primary-text: var(--tg-button-text);
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --border-color: rgba(0, 0, 0, 0.1);
            
            --radius: 0.75rem; /* –°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ */
        }

        body {
            font-family: 'Roboto', sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI";
            margin: 0;
            padding: 0;
            background-color: var(--tg-bg);
            color: var(--tg-text);
            min-height: 100vh;
            padding-bottom: 5.5rem; /* –û—Ç—Å—Ç—É–ø –¥–ª—è –Ω–∏–∂–Ω–µ–π –ø–∞–Ω–µ–ª–∏ */
        }
        .app-content { width: 100%; max-width: 500px; margin: 0 auto; padding-top: 1rem; }
        
        /* Typography */
        h1 { font-size: 1.5rem; font-weight: 700; margin: 0; color: var(--tg-text); }
        h2 { font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--tg-text); }
        .text-hint { color: var(--tg-hint); font-size: 0.9rem; }
        .font-medium { font-weight: 500; }
        
        /* Utility Classes */
        .p-4 { padding: 1rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .mt-4 { margin-top: 1rem; }
        .mb-4 { margin-bottom: 1rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-3 { gap: 0.75rem; }
        .grid { display: grid; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .w-full { width: 100%; }
        
        /* Card Component */
        .card { 
            background-color: var(--tg-secondary-bg); 
            border-radius: var(--radius); 
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05); 
            padding: 1rem;
            border: 1px solid var(--border-color);
        }

        /* Header Style */
        .header-section {
            padding: 1.5rem 1rem 1rem 1rem;
        }

        /* Form Styles */
        input[type="number"], input[type="text"], input[type="datetime-local"] {
            padding: 0.75rem;
            border: 1px solid var(--tg-hint);
            border-radius: var(--radius);
            background-color: var(--tg-secondary-bg);
            color: var(--tg-text);
            font-size: 1rem;
            box-sizing: border-box; 
            transition: border-color 0.2s;
        }
        input:focus {
            outline: none;
            border-color: var(--primary);
        }
        label {
            display: block;
            margin-top: 1rem;
            margin-bottom: 0.3rem;
            font-weight: 500;
            color: var(--tg-text);
        }

        /* Buttons and Messages */
        .primary-button {
            background-color: var(--primary);
            color: var(--primary-text);
            padding: 0.75rem 1rem;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            margin-top: 1.5rem;
            transition: background-color 0.2s;
        }
        .primary-button:active {
            filter: brightness(90%);
        }

        .message {
            padding: 0.75rem;
            border-radius: var(--radius);
            font-weight: 500;
            margin-top: 1rem;
            text-align: center;
        }
        .error-message { 
            background-color: #fef2f2; 
            color: var(--accent-red); 
            border: 1px solid #fecaca; 
        }
        .success-message { 
            background-color: #ecfdf5; 
            color: var(--accent-green); 
            border: 1px solid #a7f3d0;
        }

        /* Stat Boxes */
        .stat-box {
            background-color: var(--tg-secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1rem;
            text-align: center;
        }
        .stat-icon {
            font-size: 1.5rem;
            display: block;
            margin-bottom: 0.5rem;
        }
        .stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }
        .stat-label {
            font-size: 0.85rem;
            color: var(--tg-hint);
        }
        
        /* Match Card */
        .match-card {
            background-color: var(--tg-secondary-bg);
            border: 2px solid var(--primary);
            cursor: pointer;
            transition: transform 0.2s;
        }
        .match-card:active {
            transform: scale(0.98);
        }
        .match-result-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 700;
        }
        .badge-win { background-color: var(--accent-green); color: white; }
        .badge-loss { background-color: var(--accent-red); color: white; }
        .badge-draw { background-color: #f59e0b; color: white; }


        /* Navigation and Screens */
        .bottom-nav { 
            position: fixed; bottom: 0; left: 0; right: 0; height: 5rem; 
            background-color: var(--tg-secondary-bg); 
            border-top: 1px solid var(--border-color); 
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05); 
            display: flex; justify-content: space-around; 
            align-items: center; z-index: 100;
        }
        .nav-item { 
            display: flex; flex-direction: column; align-items: center; 
            text-decoration: none; color: var(--tg-hint); 
            font-size: 0.75rem; transition: color 0.2s;
            padding: 0.5rem;
        }
        .nav-item-active { 
            color: var(--primary); 
            font-weight: 500;
        }
        .nav-icon { font-size: 1.5rem; margin-bottom: 0.25rem; }
        .screen { display: none; padding: 0 1rem; }
        .active-screen { display: block; }

        /* Token Error */
        .token-error { 
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
            background-color: var(--tg-bg); color: var(--tg-text); 
            display: none; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 20px; z-index: 200;
        }
        .token-error h2 { color: var(--accent-red); }

    </style>
</head>
<body>
    
    <div id="main-app" class="app-content" style="display: none;">
        
        <div id="dashboard-screen" class="screen active-screen">
            <div class="header-section">
                <h1>–ü—Ä–∏–≤–µ—Ç, <span id="welcome-user" class="font-medium">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>!</h1>
                <p class="text-hint mt-1">–û–±–∑–æ—Ä –≤–∞—à–µ–π –∏–≥—Ä–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–∞—Ç—á–µ–π.</p>
            </div>

            <div class="space-y-4">
                
                <h2>–í–∞—à–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h2>
                <div class="grid grid-cols-2 gap-3">
                    <div class="stat-box">
                        <span class="stat-icon">‚öΩÔ∏è</span>
                        <div class="stat-value">12</div>
                        <div class="stat-label">–ì–æ–ª—ã (–°–µ–∑–æ–Ω)</div>
                    </div>
                    <div class="stat-box">
                        <span class="stat-icon">üéØ</span>
                        <div class="stat-value">8</div>
                        <div class="stat-label">–ê—Å—Å–∏—Å—Ç—ã (–°–µ–∑–æ–Ω)</div>
                    </div>
                    <div class="stat-box">
                        <span class="stat-icon">üí™</span>
                        <div class="stat-value">4.5</div>
                        <div class="stat-label">–†–µ–π—Ç–∏–Ω–≥ (AVG)</div>
                    </div>
                    <div class="stat-box">
                        <span class="stat-icon">‚è±Ô∏è</span>
                        <div class="stat-value">95%</div>
                        <div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç –º–∞—Ç—á–µ–π</div>
                    </div>
                </div>

                <h2 class="mt-4">–ü–æ—Å–ª–µ–¥–Ω–∏–π –º–∞—Ç—á</h2>
                <div class="card match-card" onclick="navigate('analytics')">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-hint">üìÖ 28 –æ–∫—Ç 2025 | 18:00</span>
                        <div class="match-result-badge badge-win">–ü–æ–±–µ–¥–∞ üèÜ</div>
                    </div>
                    <div class="font-medium">vs –§–ö –°–ø–∞—Ä—Ç–∞–∫</div>
                    <div class="text-hint">–°—á–µ—Ç: 2:1</div>
                </div>

                <h2 class="mt-4">–í—Å–µ –º–∞—Ç—á–∏</h2>
                <div class="space-y-3">
                    <div class="card match-card" onclick="navigate('analytics')">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-hint">üìÖ 21 –æ–∫—Ç 2025</span>
                            <div class="match-result-badge badge-draw">–ù–∏—á—å—è ü§ù</div>
                        </div>
                        <div class="font-medium">vs –§–ö –î–∏–Ω–∞–º–æ</div>
                        <div class="text-hint">–°—á–µ—Ç: 1:1</div>
                    </div>
                    </div>
            </div>
        </div>

        <div id="analytics-screen" class="screen">
            <div class="header-section">
                <h1>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–∞—Ç—á–∞</h1>
                <p class="text-hint mt-1">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–∞—Ç—á–∞.</p>
            </div>
            <div class="card">
                <h2>–ú–∞—Ç—á: –§–ö –°–ø–∞—Ä—Ç–∞–∫ (2:1)</h2>
                <p class="text-hint">28 –æ–∫—Ç—è–±—Ä—è 2025, 18:00</p>
                <div class="mt-4">
                    <p class="font-medium">–û–±–∑–æ—Ä:</p>
                    <ul style="list-style: none; padding: 0;" class="space-y-1 mt-2">
                        <li>‚öΩÔ∏è –ì–æ–ª—ã –∫–æ–º–∞–Ω–¥—ã: 2</li>
                        <li>ü•Ö –ì–æ–ª—ã —Å–æ–ø–µ—Ä–Ω–∏–∫–∞: 1</li>
                        <li>‚è±Ô∏è –í–ª–∞–¥–µ–Ω–∏–µ: 58%</li>
                        <li>üèÉ‚Äç‚ôÇÔ∏è –ü—Ä–æ–π–¥–µ–Ω–æ –∫–º (AVG): 10.5</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div id="players-screen" class="screen">
            <div class="header-section">
                <h1>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–æ–≤</h1>
                <p class="text-hint mt-1">–†–µ–π—Ç–∏–Ω–≥–∏ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.</p>
            </div>
            <div class="card">
                <p class="text-hint">–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤, –ø–æ–∏—Å–∫ –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏.</p>
                <ul class="space-y-3 mt-4" style="list-style: none; padding: 0;">
                    <li class="card">
                        <div class="flex justify-between items-center font-medium">
                            <span>1. –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω</span>
                            <span style="color: var(--primary);">–†–µ–π—Ç–∏–Ω–≥: 4.8</span>
                        </div>
                    </li>
                    <li class="card">
                        <div class="flex justify-between items-center font-medium">
                            <span>2. –ü–µ—Ç—Ä–æ–≤ –°–µ—Ä–≥–µ–π</span>
                            <span style="color: var(--accent-green);">–ì–æ–ª—ã: 12</span>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        
        <div id="stat-screen" class="screen">
            <div class="header-section">
                <h1>–í–≤–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</h1>
                <p class="text-hint mt-1">–û—Ç–ø—Ä–∞–≤–∫–∞ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∞—Ç—á–∞. –ò–≥—Ä–æ–∫: <span id="stat-user" class="font-medium"></span></p>
            </div>
            <div class="card">
                <form id="statForm">
                    
                    <label for="matchIdInput">ID –ú–∞—Ç—á–∞ (–¢–µ—Å—Ç):</label>
                    <input type="text" id="matchIdInput" value="7e743209-417c-4824-a316-562a9394628a" class="w-full">
                    <small class="text-hint">–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –±—É–¥–µ—Ç —Å–µ–ª–µ–∫—Ç–æ—Ä –∏–ª–∏ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ.</small>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label for="goals">–ì–æ–ª—ã:</label>
                            <input type="number" id="goals" value="0" min="0" class="w-full">
                        </div>
                        <div>
                            <label for="assists">–ê—Å—Å–∏—Å—Ç—ã:</label>
                            <input type="number" id="assists" value="0" min="0" class="w-full">
                        </div>
                        <div>
                            <label for="passes">–ü–µ—Ä–µ–¥–∞—á–∏:</label>
                            <input type="number" id="passes" value="0" min="0" class="w-full">
                        </div>
                        <div>
                            <label for="errors">–ü–æ—Ç–µ—Ä–∏:</label>
                            <input type="number" id="errors" value="0" min="0" class="w-full">
                        </div>
                    </div>

                    <label for="minutesPlayed">–°—ã–≥—Ä–∞–Ω–æ –º–∏–Ω—É—Ç:</label>
                    <input type="number" id="minutesPlayed" value="0" min="0" class="w-full">
                    
                    <button type="submit" class="primary-button">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    </button>
                </form>
                <div id="statMessage" class="message" style="display: none;"></div>
            </div>
        </div>

        <div id="admin-match-screen" class="screen">
            <div class="header-section">
                <h1>–ê–¥–º–∏–Ω: –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ç—á–∞</h1>
                <p class="text-hint mt-1">–¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ.</p>
            </div>
            <div class="card">
                <form id="createMatchForm">
                    <label for="matchDate">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –º–∞—Ç—á–∞:</label>
                    <input type="datetime-local" id="matchDate" required class="w-full">

                    <label for="location">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</label>
                    <input type="text" id="location" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–ª–µ —É —à–∫–æ–ª—ã ‚Ññ5" required class="w-full">

                    <label for="durationMinutes">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω—É—Ç, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                    <input type="number" id="durationMinutes" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 90" min="1" class="w-full">

                    <button type="submit" class="primary-button" style="background-color: var(--accent-green);">
                        –°–æ–∑–¥–∞—Ç—å –ú–∞—Ç—á
                    </button>
                </form>
                <div id="adminMatchMessage" class="message" style="display: none;"></div>
            </div>
        </div>


        <div class="bottom-nav">
            <a href="#" onclick="navigate('dashboard')" id="nav-dashboard" class="nav-item nav-item-active">
                <span class="nav-icon">üè†</span>
                <span>–ì–ª–∞–≤–Ω–∞—è</span>
            </a>
            <a href="#" onclick="navigate('analytics')" id="nav-analytics" class="nav-item">
                <span class="nav-icon">üìä</span>
                <span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
            </a>
            <a href="#" onclick="navigate('stat')" id="nav-stat" class="nav-item">
                <span class="nav-icon">üìù</span>
                <span>–í–≤–æ–¥</span>
            </a>
            <a href="#" onclick="navigate('players')" id="nav-players" class="nav-item">
                <span class="nav-icon">üë•</span>
                <span>–ò–≥—Ä–æ–∫–∏</span>
            </a>
            <a href="#" onclick="navigate('admin-match')" id="nav-admin-match" class="nav-item">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span>–ê–¥–º–∏–Ω</span>
            </a>
        </div>
    </div>

    <div id="token-error" class="token-error">
        <h2>‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞</h2>
        <p class="text-hint">–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.</p>
        <p class="text-hint">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram.</p>
    </div>

    <script>
        // =========================================================================
        // –ö–û–ù–°–¢–ê–ù–¢–´ –° NGROK –ê–î–†–ï–°–ê–ú–ò
        // =========================================================================
        // –ê–î–†–ï–°–ê –î–û–õ–ñ–ù–´ –ë–´–¢–¨ –û–ë–ù–û–í–õ–ï–ù–´ –ù–ê –í–ê–® –ê–ö–¢–£–ê–õ–¨–ù–´–ô NGROK URL
        const BASE_URL = 'https://definable-outspokenly-janyce.ngrok-free.dev'; 
        const STAT_SUBMIT_URL = `${BASE_URL}/api/stats/submit`; 
        const MATCH_CREATE_URL = `${BASE_URL}/api/matches`; 

        // =========================================================================
        // –õ–û–ì–ò–ö–ê –ù–ê–í–ò–ì–ê–¶–ò–ò –ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò
        // =========================================================================
        function navigate(page) {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active-screen'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('nav-item-active'));
            
            const screenElement = document.getElementById(`${page}-screen`);
            const navElement = document.getElementById(`nav-${page}`);
            
            if (screenElement) {
                screenElement.classList.add('active-screen');
                // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–≤–µ—Ä—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —ç–∫—Ä–∞–Ω–∞
                window.scrollTo(0, 0); 
            }
            if (navElement) {
                navElement.classList.add('nav-item-active');
            }
            
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
            }
        }
        
        function initApp() {
            const token = localStorage.getItem('jwt_token');
            const userName = localStorage.getItem('user_name') || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            
            if (!token) {
                document.getElementById('token-error').style.display = 'flex';
                localStorage.clear(); 
                return;
            }

            document.getElementById('welcome-user').textContent = userName;
            
            const statUserElement = document.getElementById('stat-user');
            if (statUserElement) {
                statUserElement.textContent = userName; 
            }

            document.getElementById('main-app').style.display = 'block';

            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
            }
            
            navigate('dashboard');
        }

        // =========================================================================
        // –õ–û–ì–ò–ö–ê –û–¢–ü–†–ê–í–ö–ò –§–û–†–ú (–†–ê–ë–û–ß–ê–Ø)
        // =========================================================================
        
        // 1. –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        document.getElementById('statForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const messageBox = document.getElementById('statMessage');
            messageBox.style.display = 'none';
            messageBox.className = 'message';

            if (!window.Telegram || !window.Telegram.WebApp || !window.Telegram.WebApp.initData) {
                 messageBox.textContent = '‚ùå –û—à–∏–±–∫–∞: Telegram Web App initData –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞.';
                 messageBox.className = 'message error-message';
                 messageBox.style.display = 'block';
                 return;
            }
            
            const initData = Telegram.WebApp.initData; 

            const payload = {
                initData: initData,
                matchId: document.getElementById('matchIdInput').value.trim(), 
                goals: parseInt(document.getElementById('goals').value) || 0,
                assists: parseInt(document.getElementById('assists').value) || 0,
                passes: parseInt(document.getElementById('passes').value) || 0,
                errors: parseInt(document.getElementById('errors').value) || 0,
                minutesPlayed: parseInt(document.getElementById('minutesPlayed').value) || 0,
            };
            
            if (!payload.matchId || payload.matchId.length < 5) {
                 messageBox.textContent = '‚ùå –û—à–∏–±–∫–∞: ID –º–∞—Ç—á–∞ –Ω–µ —É–∫–∞–∑–∞–Ω.';
                 messageBox.className = 'message error-message';
                 messageBox.style.display = 'block';
                 return;
            }

            try {
                const response = await fetch(STAT_SUBMIT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    messageBox.textContent = '‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!';
                    messageBox.className = 'message success-message';
                    document.getElementById('statForm').reset();
                } else {
                    const errorText = await response.text();
                    messageBox.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${errorText || response.statusText}`;
                    messageBox.className = 'message error-message';
                }
            } catch (error) {
                console.error("Fetch error:", error);
                messageBox.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: –ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º.';
                messageBox.className = 'message error-message';
            }
            messageBox.style.display = 'block';
        });

        // 2. –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ç—á–∞ (Admin)
        document.getElementById('createMatchForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const messageDiv = document.getElementById('adminMatchMessage');
            messageDiv.textContent = '';
            messageDiv.style.display = 'none';
            
            const token = localStorage.getItem('jwt_token'); 
            if (!token) {
                messageDiv.textContent = '‚ùå –û—à–∏–±–∫–∞: –í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –∏–ª–∏ –≤–∞—à —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.';
                messageDiv.className = 'message error-message';
                messageDiv.style.display = 'block';
                return;
            }

            const matchDate = document.getElementById('matchDate').value;
            const location = document.getElementById('location').value;
            const durationMinutes = document.getElementById('durationMinutes').value;

            const requestBody = {
                matchDate: matchDate,
                location: location,
                durationMinutes: durationMinutes ? parseInt(durationMinutes, 10) : null 
            };

            try {
                const response = await fetch(MATCH_CREATE_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}` 
                    },
                    body: JSON.stringify(requestBody)
                });

                const textResponse = await response.text();

                if (response.ok) {
                    messageDiv.textContent = `‚úÖ –£—Å–ø–µ—Ö! –ú–∞—Ç—á —Å–æ–∑–¥–∞–Ω. ID: ${textResponse}`;
                    messageDiv.className = 'message success-message';
                    document.getElementById('createMatchForm').reset();
                } else if (response.status === 403) {
                    messageDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ç—á–∞.`;
                    messageDiv.className = 'message error-message';
                } else {
                    messageDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (${response.status}): ${textResponse}`;
                    messageDiv.className = 'message error-message';
                }

            } catch (error) {
                console.error('Network or CORS error:', error);
                messageDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ –±—ç–∫–µ–Ω–¥.';
                messageDiv.className = 'message error-message';
            }
            messageDiv.style.display = 'block';
        });

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
